<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:include="common/header"></th:block>

<link rel="stylesheet" href="/css/service/reserveFrm.css">

	<!-- container -->
    <main id="container" class="container">

		<!-- contents -->
        <section id="contents" class="contents reserveContactless">
            <div class="inner_wrap">
                <h2>비대면 진료 예약</h2>
                <div class="reserve_area">
                    <!-- 트리거 만들지? -->
                    <!-- 예약테이블: 예약번호(시퀀스), 병원번호(h.hospitalNo), 회원번호(session), 예약상태(항상 1), 예약접수시간(선택)(sysdate yyyy-mm-dd hh:24:mi:ss), 예약타입(2:비대면), 예약시간(접수시간으로..) -->
                    <!-- 예약상세테이블: 예약상세번호(시퀀스), 예약번호(직전예약테이블번호), 의사번호(선택), 과목번호(null), 증상(null 가능), 자녀번호(null 가능) -->
                    <div class="hospital_name" th:text="${h.hospitalName}"></div>
                    <form action="/service/reserveContactless" method="post" class="reserve_form" enctype="multipart/form-data">
                        <div class="form_area">
                            <input type="hidden" name="hospitalNo" th:value="${h.hospitalNo}">
                            <input type="hidden" name="hospitalName" th:value="${h.hospitalName}"><!-- 예약완료 모달에 정보 알려주기 위함 -->
                            <input type="hidden" name="memberName" th:value="${session.member.memberName}"><!-- 예약완료 모달에 정보 알려주기 위함 -->
                            <input type="hidden" name="memberNo" th:value="${session.member.memberNo}"><!-- 접수자 본인 -->

                            <div class="input_wrap">
                                <h4 class="input_title">진료 대상자</h4>
                                <div class="select">
                                    <select id="nameSelect" name="childNo">
                                        <option th:value="0" th:text="${session.member.memberName}"></option><!-- 자녀 없을시 childNo는 null -->
                                    </select>
                                </div>
                            </div>

                            <div class="input_wrap">
                                <h4 class="input_title">진료받을 의사 선택</h4>
                                <div class="select">
                                    <select name="doctorNo">
                                        <option th:each="d : ${h.doctorList}" th:value="${d.doctorNo}" th:text="${d.doctorName}"></option>
                                    </select>
                                </div>
                            </div>

                            <div class="input_wrap">
                                <h4 class="input_title">증상 입력<em>(선택)</em></h4>
                                <div class="textarea">
                                    <textarea name="symptom" placeholder="증상을 입력해주세요(최대 120자)"></textarea>
                                </div>
                            </div>

                            <div class="input_wrap">
                                <div class="input_item">
                                    <input type="file" name="imgFile" accept=".jpg, .png, .jpeg" id="fileInput" multiple>
                                    <label for="fileInput"><span class="blind">사진 선택</span></label>
                                </div>
                            </div>

                            <div class="checkbox_wrap row">
                                <div class="input_item">
                                    <input type="checkbox" class="checkAll" name="check_agree_all" id="check_agree1">
                                    <label for="check_agree1">전체 동의</label>
                                </div>
                                <div class="input_item">
                                    <input type="checkbox" name="check_agree_req" id="check_agree1">
                                    <label for="check_agree1">(필수)개인정보 수집 및 이용 동의</label>
                                    <button type="button" class="btn_more" onclick="openModal(terms1)"><span class="blind">더보기</span></button>
                                </div>
                                <div class="input_item">
                                    <input type="checkbox" name="check_agree_req" id="check_agree2">
                                    <label for="check_agree2">(필수)민감정보 수집 및 이용 동의</label>
                                    <button type="button" class="btn_more" onclick="openModal(terms2)"><span class="blind">더보기</span></button>
                                </div>
                                <div class="input_item">
                                    <input type="checkbox" name="check_agree_req" id="check_agree3">
                                    <label for="check_agree3">(필수)고유식별정보 수집 동의</label>
                                    <button type="button" class="btn_more" onclick="openModal(terms3)"><span class="blind">더보기</span></button>
                                </div>
                            </div>

                        </div>

                        <div class="btn_area">
                            <button type="submit" class="btn_primary lg" onclick="return checkForm();">완료</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        <!--// contents -->
        
    </main>
    <!--// container -->

<!-- 약관 모달1 -->
<div id="terms1" class="modal lg" style="display:none;">
    <div class="modal_wrap">
        
        <div class="modal_header">
            <div class="modal_title">개인정보 수집 및 이용 동의</div>
        </div>

        <div class="modal_container">
            <div class="modal_content">
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
            </div>
        </div>
        
        <div class="modal_footer">
            <div class="btn_area">
                <button type="button" onclick="closeModal(this);" class="btn_primary lg">확인</button>
            </div>
        </div>

        <button type="button" onclick="closeModal(this);" class="btn_close"><span class="blind">닫기</span></button>

    </div>
</div>
<!-- 약관 모달2 -->
<div id="terms2" class="modal lg" style="display:none;">
    <div class="modal_wrap">
        
        <div class="modal_header">
            <div class="modal_title">민감정보 수집 및 이용 동의</div>
        </div>

        <div class="modal_container">
            <div class="modal_content">
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
            </div>
        </div>
        
        <div class="modal_footer">
            <div class="btn_area">
                <button type="button" onclick="closeModal(this);" class="btn_primary lg">확인</button>
            </div>
        </div>

        <button type="button" onclick="closeModal(this);" class="btn_close"><span class="blind">닫기</span></button>

    </div>
</div>
<!-- 약관 모달3 -->
<div id="terms3" class="modal lg" style="display:none;">
    <div class="modal_wrap">
        
        <div class="modal_header">
            <div class="modal_title">고유식별정보 수집 동의</div>
        </div>

        <div class="modal_container">
            <div class="modal_content">
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
                <p>텍스트는 이렇게 씁니다.</p>
            </div>
        </div>
        
        <div class="modal_footer">
            <div class="btn_area">
                <button type="button" onclick="closeModal(this);" class="btn_primary lg">확인</button>
            </div>
        </div>

        <button type="button" onclick="closeModal(this);" class="btn_close"><span class="blind">닫기</span></button>

    </div>
</div>
	
<th:block th:include="common/footer"></th:block>
<!-- js 링크 -->
<script th:inline="javascript">
    const hospital = [[${h}]];

    console.log(hospital);

    //자녀 번호 가져오기
    const memberNo = [[${session.member.memberNo}]];
    $.ajax({
        url: "/service/selectMyChildInfo", 
        type: "POST",
        dataType: "JSON",
        data: {memberNo: memberNo},
        success: function(data){
            $(data).each(function(index, item){
                const option = $("<option>");
                option.val(Number(item.childNo));
                option.text(item.childName);
                $("#nameSelect").append(option);
            })
        },
        error: function(){
            console.log("에러");
        }
    })

    //폼 전송시 값 체크
    function checkForm(){
        if(!$("[name='reservationTime']:checked").val()){
            alert("시간을 선택해주세요.");
            return false;
        }else{
            if(confirm("비대면 진료를 예약하시겠습니까?")){
                return true;
            }else{
                return false;
            }
        }
    }
</script>
</body>
</html>